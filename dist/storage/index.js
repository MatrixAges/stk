let e=new WeakMap;function t(t,r,i){let o={ctx:this,fn:i},l=e.get(t);l||e.set(t,l=new Map);let a=l.get(r);return a?a.push(o):l.set(r,[o]),()=>n(t,r,i)}function r(e,r,i){let o=this,l=(t,a)=>{n(e,r,l),i.call(o,t,a)};l.fn=i,t(e,r,l)}function n(t,r,n){if(void 0===r)return void e.set(t,new Map);let i=e.get(t);if(i){let e=i.get(r);if(e&&e.length>0){let t=[];n&&(t=e.filter(e=>e.fn!==n&&e.fn?.fn!==n)),i.set(r,t)}}}function i(t,r,...n){let o=e.get(t);if(o){let e=o.get(r);if(e){let[t,r]=n;e.forEach(e=>e.fn.call(e.ctx,t,r))}}}let o=Array.isArray,l=e=>"[object Date]"===s(e),a=e=>"string"==typeof e,f=e=>null!==e&&"object"==typeof e,u=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,s=e=>Object.prototype.toString.call(e),c=e=>s(e).slice(8,-1),g=(e,t)=>!Object.is(e,t);function p(e){try{return JSON.parse(e)}catch(t){return e}}let d=Object.prototype.hasOwnProperty,w=(e,t)=>d.call(e,t);function _(e){return(0,eval)(e)}function y(e){window.__storage_prefix__=`${e}:`}let h=new WeakMap,x={storage:{},key:"",proxy:{}},$=!0;function v(e,t){return function(){delete e[t]}}function S(e,t,...r){let n=`${x.key}.${t}`;o(e)&&u(t)&&(n=`${x.key}[${t}]`),i(x.storage,n,...r)}let k=!1,E=function(){let e={};return["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){k=!0;let r=this.length,n=h.get(this)[t].apply(this,e);return this.length>r&&S(this,"length",this.length,r),k=!1,n}}),e}();function b(e,t,r){return o(e)&&w(E,t)?Reflect.get(E,t,r):Reflect.get(e,t,r)}function m(e){$=!1;let t=x.proxy.getExpires(x.key);x.proxy[x.key]=e,t&&x.proxy.setExpires(x.key,t),$=!0}function O(e,t,r,n){let i;o(e)&&!k&&(i=e.length);let l=e[t],a=o(e)&&u(t)?Number(t)<e.length:w(e,t),f=Reflect.set(e,t,r,n);return f&&g(r,l)&&(a?S(e,t,r,l):S(e,t,r,void 0),o(e)&&void 0!==i&&Number(t)>=i&&S(e,"length",e.length,i),m(e)),f}function D(e,t){let r=w(e,t),n=e[t],i=Reflect.deleteProperty(e,t);return i&&r&&(S(e,t,void 0,n),m(e)),i}function N(e){let t=new Proxy(e,{get:b,set:O,deleteProperty:D});return h.set(t,e),t}let P={String:{read:e=>e,write:e=>e},Number:{read:e=>Number.parseFloat(e),write:e=>String(e)},BigInt:{read:e=>BigInt(e),write:e=>String(e)},Boolean:{read:e=>"true"===e,write:e=>String(e)},Null:{read:()=>null,write:e=>String(e)},Undefined:{read:()=>void 0,write:e=>String(e)},Object:{read:e=>N(e),write:e=>e},Array:{read:e=>N(e),write:e=>e},Set:{read:e=>new Set(e),write:e=>Array.from(e)},Map:{read:e=>new Map(e),write:e=>Array.from(e)},Date:{read:e=>new Date(e),write:e=>String(e)},RegExp:{read:e=>(0,eval)(e),write:e=>String(e)},Function:{read:e=>(0,eval)(`(function() { return ${e} })()`),write:e=>String(e)}};function j(e,t){if(!e)return;let r=e;try{r=p(e)}catch(e){}if(!f(r))return r;if(r.expires&&new Date(+r.expires).getTime()<=Date.now())return void t?.();let n=P[r.type];return n?n.read(r.value):r.value}function R(e,t){let r=c(e),n=P[r];if(!n)throw Error(`can't set "${r}" property.`);let i={type:r,value:n.write(e)};return t&&(i.expires=t),JSON.stringify(i)}function M(e,t,r,n){let i;if((i=l(r)?r.getTime():a(r)?+r.padEnd(13,"0"):r)<=Date.now())return void delete n[t];let o=n[t];if(o)return o=h.get(o)||o,e[`${window.__storage_prefix__||""}${t}`]=R(o,""+i),new Date(i)}function I(e,t){let r=`${window.__storage_prefix__||""}${t}`;if(!e[r])return;let n=p(e[r]);if(!(!f(n)||!n.expires||+n.expires<=Date.now()))return new Date(+n.expires)}function V(e,t,r){let n=r[t];n&&(n=h.get(n)||n,e[`${window.__storage_prefix__||""}${t}`]=R(n))}let A=new Map;function B(e,i,o){$&&(x.storage=e,x.key=i,x.proxy=o);let l=A.get(e);if(l||(l=function(e,i){let o={};["clear","key"].forEach(t=>{o[t]=e[t].bind(e)});let l={getItem:B,setItem:W,setExpires:M,removeExpires:V};Object.keys(l).forEach(t=>{o[t]=function(...r){return l[t](e,...r,i)}});let a={removeItem:J,getExpires:I,off:n,on:t,once:r};return Object.keys(a).forEach(t=>{o[t]=function(...r){return a[t](e,...r)}}),o}(e,o),A.set(e,l)),w(l,i))return Reflect.get(l,i,o);if(!F(e,i))return;let a=`${window.__storage_prefix__||""}${i}`,f=e[a]||e[i];return f?j(f,v(e,a)):f}function W(e,t,r,n){let o=`${window.__storage_prefix__||""}${t}`,l=j(e[o],v(e,o));l=h.get(l)||l;let a=Reflect.set(e,o,R(r),n);return a&&g(r,l)&&$&&i(e,t,r,l),a}function F(e,t){return e.hasOwnProperty(`${window.__storage_prefix__||""}${t}`)||!e.hasOwnProperty(t)&&t in e}function J(e,t){let r=`${window.__storage_prefix__||""}${t}`,n=w(e,r),o=j(e[r],v(e,r));o=h.get(o)||o;let l=Reflect.deleteProperty(e,r);return l&&n&&i(e,t,void 0,o),l}function T(e){return e?new Proxy(e,{get:B,set:W,has:F,deleteProperty:J}):null}let L="undefined"!=typeof localStorage?localStorage:void 0,U="undefined"!=typeof sessionStorage?sessionStorage:void 0;"undefined"!=typeof window&&window.addEventListener("storage",e=>{if(e.key&&e.key.startsWith(window.__storage_prefix__||"")){let t=e.newValue,r=e.oldValue;e.newValue&&f(t=j(e.newValue,v(L,e.key)))&&(t=h.get(t)||t),e.oldValue&&f(r=j(e.oldValue,v(L,e.key)))&&(r=h.get(r)||r),i(L,e.key.slice((window.__storage_prefix__||"").length),t,r)}});let q=T(L),z=T(U);export{j as decode,R as encode,q as local,z as session,y as setPrefix};